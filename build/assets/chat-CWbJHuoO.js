var T=n=>{throw TypeError(n)};var $=(n,t,s)=>t.has(n)||T("Cannot "+s);var u=(n,t,s)=>($(n,t,"read from private field"),s?s.call(n):t.get(n)),w=(n,t,s)=>t.has(n)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,s),E=(n,t,s,r)=>($(n,t,"write to private field"),r?r.call(n,s):t.set(n,s),s),C=(n,t,s)=>($(n,t,"access private method"),s);import{S as F,s as K,h as O,g as z,n as R,u as L,r as b,j as e,a as B}from"./index-BZ6FMMt2.js";import{c as U}from"./balanceCalculations-BwgctEfh.js";var j,v,g,f,y,P,k,I,G=(I=class extends F{constructor(t,s){super();w(this,y);w(this,j);w(this,v);w(this,g);w(this,f);E(this,j,t),this.setOptions(s),this.bindMethods(),C(this,y,P).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=u(this,j).defaultMutationOptions(t),K(this.options,s)||u(this,j).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,g),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&O(s.mutationKey)!==O(this.options.mutationKey)?this.reset():((r=u(this,g))==null?void 0:r.state.status)==="pending"&&u(this,g).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=u(this,g))==null||t.removeObserver(this)}onMutationUpdate(t){C(this,y,P).call(this),C(this,y,k).call(this,t)}getCurrentResult(){return u(this,v)}reset(){var t;(t=u(this,g))==null||t.removeObserver(this),E(this,g,void 0),C(this,y,P).call(this),C(this,y,k).call(this)}mutate(t,s){var r;return E(this,f,s),(r=u(this,g))==null||r.removeObserver(this),E(this,g,u(this,j).getMutationCache().build(u(this,j),this.options)),u(this,g).addObserver(this),u(this,g).execute(t)}},j=new WeakMap,v=new WeakMap,g=new WeakMap,f=new WeakMap,y=new WeakSet,P=function(){var s;const t=((s=u(this,g))==null?void 0:s.state)??z();E(this,v,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},k=function(t){R.batch(()=>{var s,r,i,d,l,o,x,p;if(u(this,f)&&this.hasListeners()){const h=u(this,v).variables,a=u(this,v).context;(t==null?void 0:t.type)==="success"?((r=(s=u(this,f)).onSuccess)==null||r.call(s,t.data,h,a),(d=(i=u(this,f)).onSettled)==null||d.call(i,t.data,null,h,a)):(t==null?void 0:t.type)==="error"&&((o=(l=u(this,f)).onError)==null||o.call(l,t.error,h,a),(p=(x=u(this,f)).onSettled)==null||p.call(x,void 0,t.error,h,a))}this.listeners.forEach(h=>{h(u(this,v))})})},I);function W(n,t){return typeof n=="function"?n(...t):!!n}function _(){}function q(n,t){const s=L(),[r]=b.useState(()=>new G(s,n));b.useEffect(()=>{r.setOptions(n)},[r,n]);const i=b.useSyncExternalStore(b.useCallback(l=>r.subscribe(R.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=b.useCallback((l,o)=>{r.mutate(l,o).catch(_)},[r]);if(i.error&&W(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:d,mutateAsync:i.mutate}}const V=[{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"},{id:"gpt-4",name:"GPT-4"},{id:"claude-3-sonnet",name:"Claude 3 Sonnet"},{id:"llama-2-70b",name:"Llama 2 70B"}],D=[{id:"minimal",name:"Mínimo",description:"Respuestas muy rápidas y básicas"},{id:"low",name:"Bajo",description:"Respuestas rápidas y directas"},{id:"medium",name:"Medio",description:"Balance entre velocidad y razonamiento"},{id:"high",name:"Alto",description:"Razonamiento profundo y detallado"}];function X({config:n,onConfigChange:t,isVisible:s,onToggleVisibility:r}){var h;const[i,d]=b.useState(n),[l,o]=b.useState("top-p"),x=()=>{const a={...i};a.temperature=Math.max(0,Math.min(2,a.temperature)),a.topK=Math.max(0,Math.min(20,a.topK)),a.topP=Math.max(0,Math.min(1,a.topP)),l==="top-p"?a.topK=0:a.topP=0,["minimal","low","medium","high"].includes(a.reasoningEffort)||(a.reasoningEffort="medium"),d(a),t(a),r()},p=()=>{d({model:"gpt-3.5-turbo",temperature:.7,topP:1,topK:0,reasoningEffort:"medium",maxTokens:1e3,systemPrompt:"Eres un asistente financiero especializado en la aplicación Walletfy. Tu trabajo es ayudar a los usuarios a entender y gestionar mejor sus finanzas personales basándote en los datos de su aplicación. Proporciona consejos útiles, análisis de patrones de gasto, y responde preguntas específicas sobre sus transacciones e ingresos.",apiEndpoint:"http://localhost:4000/api/completion"})};return s?e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 flex items-center gap-2",children:[e.jsx("span",{children:"⚙️"}),"Configuración del Chat"]}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 transition-colors",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modelo"}),e.jsx("select",{value:i.model,onChange:a=>d(m=>({...m,model:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:V.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Temperatura: ",i.temperature.toFixed(1)]}),e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:i.temperature,onChange:a=>{const m=Math.max(0,Math.min(2,parseFloat(a.target.value)));d(N=>({...N,temperature:m}))},className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Más preciso (0)"}),e.jsx("span",{children:"Más creativo (2)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de Sampling"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>o("top-p"),className:`px-3 py-1 text-xs rounded-md transition-colors ${l==="top-p"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Top-P"}),e.jsx("button",{type:"button",onClick:()=>o("top-k"),className:`px-3 py-1 text-xs rounded-md transition-colors ${l==="top-k"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Top-K"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solo uno puede estar activo"})]}),e.jsxs("div",{className:l==="top-k"?"opacity-50":"",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Top-P: ",i.topP.toFixed(2)]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:i.topP,disabled:l==="top-k",onChange:a=>{const m=Math.max(0,Math.min(1,parseFloat(a.target.value)));d(N=>({...N,topP:m}))},className:"w-full disabled:opacity-50"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Más determinista (0)"}),e.jsx("span",{children:"Más diverso (1)"})]})]}),e.jsxs("div",{className:l==="top-p"?"opacity-50":"",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Top-K"}),e.jsx("input",{type:"number",min:"0",max:"20",step:"1",value:i.topK,disabled:l==="top-p",onChange:a=>{const m=Math.max(0,Math.min(20,parseInt(a.target.value)||0));d(N=>({...N,topK:m}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:opacity-50",placeholder:"0-20"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de tokens candidatos (0-20, 0=desactivado)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Esfuerzo de Razonamiento"}),e.jsx("select",{value:i.reasoningEffort,onChange:a=>d(m=>({...m,reasoningEffort:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:D.map(a=>e.jsx("option",{value:a.id,title:a.description,children:a.name},a.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(h=D.find(a=>a.id===i.reasoningEffort))==null?void 0:h.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Máximo de tokens"}),e.jsx("input",{type:"number",min:"100",max:"4000",step:"100",value:i.maxTokens,onChange:a=>d(m=>({...m,maxTokens:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endpoint API"}),e.jsx("input",{type:"url",value:i.apiEndpoint,onChange:a=>d(m=>({...m,apiEndpoint:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"http://localhost:4000/api/completion"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prompt del sistema"}),e.jsx("textarea",{value:i.systemPrompt,onChange:a=>d(m=>({...m,systemPrompt:a.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Define cómo debe comportarse el asistente..."})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"🔄 Restablecer"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"💾 Guardar"})]})]})]}):e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-4 py-2",children:e.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx("span",{children:"⚙️"}),"Configuración",e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:n.model})]})})}function H(n,t){const s=U(n,t),r=n.filter(o=>o.type==="ingreso").reduce((o,x)=>o+x.amount,0),i=n.filter(o=>o.type==="egreso").reduce((o,x)=>o+x.amount,0),d=t+r-i,l=[...n].sort((o,x)=>new Date(x.date).getTime()-new Date(o.date).getTime()).slice(0,10).map(o=>({name:o.name,description:o.description,amount:o.amount,type:o.type,date:o.date}));return{initialBalance:t,totalEvents:n.length,totalIncome:r,totalExpenses:i,currentBalance:d,monthlyData:s.map(o=>({month:o.month,monthName:o.monthName,totalIncome:o.totalIncome,totalExpenses:o.totalExpenses,monthlyBalance:o.monthlyBalance,globalBalance:o.globalBalance,eventCount:o.events.length})),recentEvents:l}}async function J(n,t,s){const r={...t,temperature:Math.max(0,Math.min(2,t.temperature)),topP:Math.max(0,Math.min(1,t.topP)),topK:Math.max(0,Math.min(20,t.topK))},i=`${t.systemPrompt}

CONTEXTO DE LA APLICACIÓN WALLETFY:
- Balance inicial del usuario: $${s.initialBalance}
- Balance actual: $${s.currentBalance.toFixed(2)}
- Total de eventos registrados: ${s.totalEvents}
- Ingresos totales: $${s.totalIncome.toFixed(2)}
- Gastos totales: $${s.totalExpenses.toFixed(2)}
- Balance neto: $${(s.totalIncome-s.totalExpenses).toFixed(2)}

DATOS POR MES:
${s.monthlyData.map(p=>`• ${p.monthName}: ${p.eventCount} eventos, Ingresos: $${p.totalIncome.toFixed(2)}, Gastos: $${p.totalExpenses.toFixed(2)}, Balance del mes: $${p.monthlyBalance.toFixed(2)}, Balance acumulado: $${p.globalBalance.toFixed(2)}`).join(`
`)}

EVENTOS RECIENTES (últimos 10):
${s.recentEvents.map((p,h)=>`${h+1}. ${p.name} - $${p.amount} (${p.type}) - ${new Date(p.date).toLocaleDateString()}`).join(`
`)}

Usa esta información para proporcionar respuestas precisas y útiles sobre las finanzas del usuario. Puedes analizar patrones, dar consejos, identificar tendencias y responder preguntas específicas basándote en estos datos reales.`,d={temperature:r.temperature,reasoning_effort:r.reasoningEffort};r.topP>0?d.top_p=r.topP:r.topK>0&&(d.top_k=r.topK);const l={input:`CONTEXTO: ${i}

PREGUNTA DEL USUARIO: ${n}`,params:d},o=await fetch(r.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!o.ok)throw new Error("Error al enviar mensaje");const x=await o.json();return{message:x.message||x.content||"Sin respuesta"}}function Q(){const[n,t]=b.useState([]),[s,r]=b.useState(""),[i,d]=b.useState(!1),[l,o]=b.useState(null),[x,p]=b.useState({model:"gpt-3.5-turbo",temperature:.7,topP:1,topK:0,reasoningEffort:"medium",maxTokens:1e3,systemPrompt:"Eres un asistente financiero especializado en la aplicación Walletfy. Tu trabajo es ayudar a los usuarios a entender y gestionar mejor sus finanzas personales basándote en los datos de su aplicación. Proporciona consejos útiles, análisis de patrones de gasto, y responde preguntas específicas sobre sus transacciones e ingresos.",apiEndpoint:"http://localhost:4000/api/completion"}),h=B(c=>c.events.events),a=B(c=>c.app.initialBalance);b.useEffect(()=>{const c=H(h,a);o(c)},[h,a]);const m=q({mutationFn:c=>{if(!l)throw new Error("Contexto de la aplicación no disponible");return J(c,x,l)},onSuccess:c=>{const M={id:Date.now().toString()+"-bot",content:c.message,isUser:!1,timestamp:new Date};t(S=>[...S,M])},onError:c=>{const M={id:Date.now().toString()+"-error",content:`❌ Error: ${c.message}`,isUser:!1,timestamp:new Date};t(S=>[...S,M])}}),N=c=>{if(c.preventDefault(),!s.trim()||m.isPending||!l)return;const M={id:Date.now().toString(),content:s,isUser:!0,timestamp:new Date};t(S=>[...S,M]),m.mutate(s),r("")},A=()=>{t([])};return l?e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"🤖"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Asistente Financiero Walletfy"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Balance actual: $",l.currentBalance.toFixed(2)," • ",l.totalEvents," eventos registrados"]})]})]}),e.jsx("button",{onClick:A,className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors flex items-center gap-1",children:"🗑️ Limpiar Chat"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-20",children:[e.jsx("span",{className:"text-4xl block mb-4",children:"💰"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"¡Hola! Soy tu asistente financiero de Walletfy"}),e.jsx("p",{className:"text-sm mb-4",children:"Puedo ayudarte a:"}),e.jsxs("div",{className:"text-left max-w-md mx-auto space-y-2 text-sm",children:[e.jsx("p",{children:"• 📊 Analizar tus patrones de gasto e ingreso"}),e.jsx("p",{children:"• 💡 Darte consejos financieros personalizados"}),e.jsx("p",{children:"• 📈 Revisar tu balance y tendencias mensuales"}),e.jsx("p",{children:"• 🔍 Buscar información específica de tus transacciones"}),e.jsx("p",{children:"• 🎯 Ayudarte a planificar mejor tu presupuesto"})]}),e.jsx("p",{className:"text-sm mt-4 text-blue-600",children:"Escribe cualquier pregunta sobre tus finanzas para comenzar"})]}):n.map(c=>e.jsx("div",{className:`flex ${c.isUser?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"flex items-start gap-2 max-w-xs md:max-w-md lg:max-w-2xl",children:[!c.isUser&&e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:"🤖"}),e.jsxs("div",{className:`px-4 py-2 rounded-lg ${c.isUser?"bg-blue-500 text-white rounded-br-sm":"bg-white border border-gray-200 rounded-bl-sm"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:c.content}),e.jsx("p",{className:`text-xs mt-1 ${c.isUser?"text-blue-100":"text-gray-500"}`,children:c.timestamp.toLocaleTimeString()})]}),c.isUser&&e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:"👤"})]})},c.id)),m.isPending&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:"🤖"}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg rounded-bl-sm px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Analizando tus datos financieros"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})]})})]}),e.jsx(X,{config:x,onConfigChange:p,isVisible:i,onToggleVisibility:()=>d(!i)}),e.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:e.jsxs("form",{onSubmit:N,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:c=>r(c.target.value),placeholder:"Pregúntame sobre tus finanzas, patrones de gasto, consejos, etc...",disabled:m.isPending,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsxs("button",{type:"submit",disabled:!s.trim()||m.isPending,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-1",children:[e.jsx("span",{children:"💬"}),"Enviar"]})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando contexto de la aplicación..."})]})})}const te=()=>e.jsx(Q,{});export{te as component};
